-- DIM_APPAREILS
CREATE TABLE DWH_DIM_APPAREILS (
    SK_APPAREIL_ID INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    APPAREIL_ID VARCHAR(10) NOT NULL,
    MARQUE VARCHAR(100) NOT NULL,
    MODELE VARCHAR(100) NOT NULL,
    CAPACITE NUMBER NOT NULL,
    ANNEE_FABRICATION NUMBER NOT NULL,
    STATUT VARCHAR(50) NOT NULL,
    DATE_DEBUT_VALIDITE DATE DEFAULT SYSDATE NOT NULL,
    DATE_FIN_VALIDITE DATE,
    IS_CURRENT INT DEFAULT 1
);

-- DIM_VOLS
CREATE TABLE DWH_DIM_VOLS (
    SK_VOL_ID INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    VOL_ID VARCHAR(10)NOT NULL,
    FK_APPAREIL_ID INT NOT NULL,
    DATE_VOL DATE NOT NULL,
    VILLE_DEPART VARCHAR(100) NOT NULL,
    VILLE_ARRIVEE VARCHAR(100) NOT NULL,
    DISTANCE_VOL NUMBER NOT NULL,
    DUREE_VOL NUMBER NOT NULL,
    STATUT VARCHAR(50) NOT NULL,
    DATE_DEBUT_VALIDITE DATE DEFAULT SYSDATE NOT NULL,
    DATE_FIN_VALIDITE DATE,
    IS_CURRENT INT DEFAULT 1,
    FOREIGN KEY (FK_APPAREIL_ID) references DWH_DIM_APPAREILS(SK_APPAREIL_ID)
);

-- DIM_PARTICIPANTS
CREATE TABLE DWH_DIM_PARTICIPANTS (
    SK_PARTICIPANT_ID INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    PARTICIPANT_ID INT NOT NULL,
    NOM VARCHAR(100) NOT NULL,
    PRENOM VARCHAR(100) NOT NULL,
    STATUT_FIDELITE VARCHAR(50) NOT NULL,
    AGE NUMBER NOT NULL,
    GENRE VARCHAR(10) NOT NULL,
    EMAIL VARCHAR(100) NOT NULL,
    TELEPHONE VARCHAR(20),
    ADRESSE VARCHAR(200) NOT NULL,
    VILLE VARCHAR(200) NOT NULL,
    PAYS VARCHAR(200) NOT NULL,
    DATE_DEBUT_VALIDITE DATE DEFAULT SYSDATE NOT NULL,
    DATE_FIN_VALIDITE DATE,
    IS_CURRENT INT DEFAULT 1,
    CHECK (GENRE in ('Homme', 'Femme'))
);

-- DIM_VISITEUR

CREATE TABLE DWH_DIM_VISITEURS(
    SK_VISITEUR_ID INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    VISITEUR_ID INT NOT NULL, 
    NOM VARCHAR(25) NOT NULL,
    PRENOM VARCHAR(25) NOT NULL,
    MAIL VARCHAR(100) NOT NULL,
    TELEPHONE VARCHAR(20),
    DATE_DEBUT_VALIDITE DATE DEFAULT SYSDATE NOT NULL,
    DATE_FIN_VALIDITE DATE,
    IS_CURRENT INT DEFAULT 1
);

-- DIM_CANALDISTRIBUTION
CREATE TABLE DWH_DIM_CANALDISTRIBUTION (
    SK_CANAL_ID INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CANAL_ID INT NOT NULL,
    NOM_CANAL VARCHAR(50) NOT NULL,
    TYPE_CANAL VARCHAR(20) NOT NULL,
    DATE_DEBUT_VALIDITE DATE DEFAULT SYSDATE NOT NULL,
    DATE_FIN_VALIDITE DATE,
    IS_CURRENT INT DEFAULT 1
);

-- DIM_CLASSE

CREATE TABLE DWH_DIM_CLASSE (
    SK_CLASSE_ID INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLASSE_ID INT NOT NULL, 
    NOM_CLASSE VARCHAR(20) NOT NULL,
    AVANTAGES VARCHAR(100) NOT NULL,
    DATE_DEBUT_VALIDITE DATE DEFAULT SYSDATE NOT NULL,
    DATE_FIN_VALIDITE DATE,
    IS_CURRENT INT DEFAULT 1
);

-- DIM_PROMOTION
CREATE TABLE DWH_DIM_PROMOTION (
    SK_PROMOTION_ID INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    PROMOTION_ID INT NOT NULL,
    NOM_PROMOTION VARCHAR(30) NOT NULL,
    DESCRIPTION VARCHAR(100) NOT NULL,
    DATE_DEBUT_VALIDITE DATE DEFAULT SYSDATE NOT NULL,
    DATE_FIN_VALIDITE DATE,
    IS_CURRENT INT DEFAULT 1,
    DATE_LOAD DATE DEFAULT SYSDATE NOT NULL
);

-- DIM_BILLET
CREATE TABLE DWH_DIM_BILLET (
    SK_BILLET_ID INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    BILLET_ID INT NOT NULL,
    SK_CANAL_ID INT NOT NULL,
    SK_VOL_ID INT NOT NULL,
    TARIF_BASE NUMBER(10,2) NOT NULL,
    PRIX_ACHAT NUMBER(10,2) NOT NULL,
    DATE_ACHAT DATE NOT NULL,
    CLASSE VARCHAR(20) NOT NULL,
    STATUT VARCHAR(10) NOT NULL,
    DATE_DEBUT_VALIDITE DATE DEFAULT SYSDATE NOT NULL,
    DATE_FIN_VALIDITE DATE,
    IS_CURRENT INT DEFAULT 1,
    DATE_LOAD DATE DEFAULT SYSDATE NOT NULL,
    FOREIGN KEY (SK_CANAL_ID) REFERENCES DWH_DIM_CANALDISTRIBUTION (SK_CANAL_ID),
    FOREIGN KEY (SK_VOL_ID) REFERENCES DWH_DIM_VOLS (SK_VOL_ID)
    
);


-- FAIT_PROMOTION
CREATE TABLE DWH_FAIT_PROMOTION (
    ID_PROMOTION INT PRIMARY KEY,
    SK_BILLET_ID INT NOT NULL,
    SK_PROMOTION_ID INT NOT NULL,
    TAUX_PROMOTION NUMBER(5,2) NOT NULL,
    DATE_DEBUT DATE NOT NULL,
    DATE_FIN DATE NOT NULL,
    FOREIGN KEY (SK_BILLET_ID) REFERENCES DWH_DIM_BILLET(SK_BILLET_ID),
    FOREIGN KEY (SK_PROMOTION_ID) REFERENCES DWH_DIM_PROMOTION(SK_PROMOTION_ID)
);

-- FAIT_SURCLASSEMENT
CREATE TABLE DWH_FAIT_SURCLASSEMENT (
    ID_SURCLASSEMENT INT PRIMARY KEY,
    SK_BILLET_ID INT NOT NULL,
    SK_CLASSE_ID INT NOT NULL,
    SURCLASSEMENT NUMBER(1) NOT NULL, 
    TARIF_SUPPLEMENTAIRE NUMBER(10,2),
    FOREIGN KEY (SK_BILLET_ID) REFERENCES DWH_DIM_BILLET(SK_BILLET_ID)
);

-- FAIT_CANALVISI
CREATE TABLE DWH_FAIT_CANALVISI (
    ID INT PRIMARY KEY,
    SK_CANAL_ID INT NOT NULL,
    SK_VISITEUR_ID INT NOT NULL,
    FOREIGN KEY (SK_CANAL_ID) REFERENCES DWH_DIM_CANALDISTRIBUTION(SK_CANAL_ID)
);

-- FAIT_MILES
CREATE TABLE DWH_FAIT_MILES (
    ID INT PRIMARY KEY,
    SK_PARTICIPANT_ID INT NOT NULL,
    SK_VOL_ID INT NOT NULL,
    MILES_CALCULES NUMBER NOT NULL,
    FOREIGN KEY (SK_PARTICIPANT_ID) REFERENCES DWH_DIM_PARTICIPANTS(SK_PARTICIPANT_ID),
    FOREIGN KEY (SK_VOL_ID) REFERENCES DWH_DIM_VOLS(SK_VOL_ID)
);